<!DOCTYPE html>
<html>
<head>
<title>Live Streaming TV</title>
<script src="js/hls.js"></script>
<script src="js/jquery.js"></script>
<script>
  function selectChannel() {
    $.ajax({
      type: 'POST',
      url: 'select_channel',
      cache: false,
      data: { ch: $('#channel_list [name=ch]:checked').val() }
    });
  }
  function capture() {
    var v = document.getElementById('video');
    var c = document.createElement('canvas');
    var ctx = c.getContext('2d');
    c.width = v.videoWidth;
    c.height = v.videoHeight;
    ctx.drawImage(v, 0, 0);
    $.ajax({
      type: 'POST',
      url: 'tweet',
      cache: false,
      data: { url: c.toDataURL() },
      success: function() {
        c.remove();
      }
    });
  }
  function bind() {
    $(window).keyup(function(e) {
      if (e.keyCode == 84) {
        this.capture();
      }
    });
  }
</script>
</head>
<body onload="bind()">
<video controls autoplay id="video" width="100%"></video>
<script>
  if (Hls.isSupported()) {
    var video = document.getElementById('video');
    var hls = new Hls();
    hls.loadSource('hls/stream.m3u8');
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, function() {
      video.play();
    });
  }
  $.ajax({
    type: 'GET',
    url: 'current_channel.json',
    cache: false,
    success: function(json) {
      document.getElementById(json[1]).checked = true;
    }
  });
</script>
<form id="channel_list" name="channel_list">
<input type="radio" id="14" name="ch" value="14"><label for="14">ＮＨＫ総合・東京</label>
<input type="radio" id="13" name="ch" value="13"><label for="13">ＮＨＫＥテレ東京</label>
<input type="radio" id="12" name="ch" value="12"><label for="12">日本テレビ</label>
<input type="radio" id="11" name="ch" value="11"><label for="11">テレビ朝日</label>
<input type="radio" id="9" name="ch" value="9"><label for="9">ＴＢＳ</label>
<input type="radio" id="10" name="ch" value="10"><label for="10">テレビ東京</label>
<input type="radio" id="8" name="ch" value="8"><label for="8">フジテレビジョン</label>
<input type="radio" id="3" name="ch" value="3"><label for="3">ＴＯＫＹＯ　ＭＸ</label>
<input type="button" id="channel_select" onclick="selectChannel()" value="SELECT">
</form>
<br><br>
<iframe src="http://tv.so-net.ne.jp/chart/23.action" width="100%" height="500px"></iframe>
</body>
</html>
